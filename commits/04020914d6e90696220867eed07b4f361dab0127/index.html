<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>git-read</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" data-turbolinks-track="reload" />
    <link href="../../stylesheets/syntax.css" rel="stylesheet" data-turbolinks-track="reload" />
    <script src="../../main.js" data-turbolinks-track="reload"></script>
  </head>
  <body class="page">
    <details id="table-of-contents" class="page__history" open>
      <summary class="page__history-summary">Table of Contents</summary>
      <nav class="history">
        <a href="../../">git-read</a>

          <a href="../5d59b45ece450d98e2c4149b9db57bc1e4a9041f/">Ensure `tmp&#x2F;` and `source&#x2F;` directories exist
</a>
          <a href="../42a35c8343ae3ed962c3b21f62e1ec917ce34eec/">Introduce `Makefile`
</a>
          <a href="../87314ace144e16df7dba371f5106ec669f41aa17/">Created `README.md`
</a>
          <a href="../11f450c4b9b84d5d248dfcea206e34a4d8fb78c2/">Create the `.gitignore` file
</a>
          <a href="../43e0f6109cf2640ca94f90adf30a49de0b4c45d9/">template things out</a>
          <a href="../1966ee21ea7ad0dafeea2e930090fa3833c8514e/">generate more data</a>
          <a href="../c96f22474b8ae1153843de9c5262479a4c362626/">make available in other git directory</a>
          <a href="../dd647ec9cf6dc7c70a05b3896a464fda75113999/">current README, fix data file</a>
          <a href="../af567ecfe89778417d201afdb21d066ab21005d3/">move partial to top level template</a>
          <a href="../32a94acaae522a307bb2e83c3e4d197812b36609/">include CSS from Syntax highlighting</a>
          <a href="../aa6a082747a63d8daa51b3cffbfb15890e5b5e3a/">Install `bitters` for base styles
</a>
          <a href="../e9eda25546b8a590fac97a6de1ec9823a42fc888/">start to style page</a>
          <a href="../f83e06a9192e77bfaf8c66d8c33384ee68282193/">Prepare to generate JavaScript with Make</a>
          <a href="../11ccf674d47028ee591149134ea1b8c2eb28024a/">build JavaScript assets with Make</a>
          <a href="../532b5734e3b10910123cf899bc097c8ece44b749/">install Turbolinks, bundle with webpack</a>
          <a href="../93187d4cfbd11eb151de1685a770ecf72365f35b/">streamline Makefile</a>
          <a href="../e52955299c3c900a20d8e153c9be17069dca7c5c/">start to style layout</a>
          <a href="../f9d59463eccada46f3089f226ec6b787f877b4a9/">introduce CommitHelpers
</a>
          <a href="../13df0b4af96c16f7e021eb7fbb25ea79ccea471c/">more styling</a>
          <a href="../2aaa7efa50385d8983c28272dcf4233d1c4e9957/">Introduce `bin&#x2F;git-read`
</a>
          <a href="../03b2b6a853548bc7321e6018ce08ee44e5a74fa0/">make history collapsible on mobile</a>
          <a href="../63110797e2ae4d436da0839e56b60ff3f04a47bd/">Restore default `ul` and `ol` within Markdown
</a>
          <a href="../8f80bdd482310d51c9493e1dc75ce6b94f33d3d0/">Add &quot;current&quot; styles to `&lt;a&gt;` elements
</a>
          <a href="../5e6606a521316b80384903080d5cfdfc4c688343/">fixup JS&#x2F;webpack, external pipelines</a>
          <a href="../34e7b71a490ed1618c670ed25ac1b9aa2039015d/">generate data, don&#x27;t generate templates</a>
          <a href="../23ea6e6eef66f47579380e27bcdea4617fb3b67a/">Improve installation and cross-platform capabilities</a>
          <a href="./" aria-current="page">Make your life easier with `ruby-git`
</a>
          <a href="../ce8d2db85a79d0acea721fb9c572102e8252025f/">improve setup</a>
          <a href="../319fb52a8833df9f36c31f3508e1a0e1997568da/">workflow</a>
          <a href="../ac343c8b674197a76aa02cf4596ac7b335fca9b5/">parallelize, cache</a>
          <a href="../f2ca94be72c920820b0f6830c48e8a9b2dc13a04/">combine calls to make</a>
          <a href="../5b66b59687169a79cf5ff8e606763cdd1c4e8e52/">fetch SHAs</a>
          <a href="../e216028c90ac13e9bd00abb412def411cead51dc/">minimize output, try and get whole tree</a>
          <a href="../92dc79b152dbb924565d533bf653238e49c01eca/">move files around after building</a>
          <a href="../79d2aa7bf8632500ff72b7aa0dbd1105ee850a66/">include Gemfile.lock for caching</a>
          <a href="../a3261a4a1f7c03e6cdae192d781bac32c63b301b/">build without cache</a>
          <a href="../d45d05f7dda519945cfe8b1b6de1ef523b28e6cf/">publish with different Action</a>
          <a href="../f10c24c94183013b17a22c8d348682fffa658347/">import assets relatively</a>
          <a href="../1abe4d0b0560fd6561fbc015c061e4340f90ad2d/">add caching back</a>
          <a href="../b2c8bc4325f38c8605bd400cc0d6056b32dfbfcb/">bust Gemfile cache, use relative links</a>
          <a href="../37c8d237d1821ac5255b0dc493dd0b07b189311b/">integrate with sitemap</a>
          <a href="../4de4aed13cdd07ee8de9e421f31249023bc8f218/">make it relative</a>
          <a href="../e19722f077e0c9df4c232229ae69534b4b50cb2d/">properly call no limit on git log</a>
          <a href="../31826742a47eecc7666a32dfc81643b55e5bebb1/">bust cache</a>
          <a href="../d19b75814f4a66e2ec2bc1a49b4226e71352376b/">sync ruby versions</a>
          <a href="../8ceee65d0eeb9c029b56d0a502d32aa5cba58db2/">do not cache</a>
          <a href="../88630325e3adad1b4f6922d9c66270d0953a63c8/">add back caching, use sitemap branch of current</a>
          <a href="../a08ee4e2c6f42e34749e903815054950d9569ab5/">Add link to project root</a>
          <a href="../406938f2d1f25bb6c83353df84718db343421b84/">configure command to take git directory and output</a>
          <a href="../63d6e19355548a1c9ccb389cfcb3e326339ae1ad/">improve spacing</a>
          <a href="../b2e8cd2780b51aa41ad60922e73231007c89b963/">WIP</a>
          <a href="../f9d2e835af4ec5454876b02a604f88f372f8c43b/">Render files when initial commit</a>
          <a href="../e775a2985b99a0b02bfa566943b351269271c1c1/">memoize</a>
          <a href="../90a9873b074ffca4def61bd176a33c099bdef501/">extend the `bin&#x2F;git-read` command to take flags:
</a>
      </nav>
    </details>

    <main class="page__content">
      <header class="navigation">

<a href="../23ea6e6eef66f47579380e27bcdea4617fb3b67a/">              &#8592; Previous
</a>
<a href="../ce8d2db85a79d0acea721fb9c572102e8252025f/">              Next &#8594;
</a>      </header>

      <article class="commit">
        <h1>Make your life easier with <code>ruby-git</code></h1>

<p>The <a href="https://github.com/ruby-git/ruby-git/tree/v1.6.0#examples"><code>ruby-git</code></a> gem provides Ruby-level access to the Git
history.</p>



              <details open>
  <summary>.gitignore</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/.gitignore b/.gitignore
index 501019d..0b15eb7 100644
</span><span class="gd">--- a/.gitignore
</span><span class="gi">+++ b/.gitignore
</span><span class="p">@@ -1,9 +1,3 @@</span>
<span class="gd">-dist/
-build/
-tmp/
-source/index.html.*
-/data/
-
</span> .bundle
 .cache
 .DS_Store
</code></pre></div></details>

              <details open>
  <summary>Gemfile</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile b/Gemfile
index 1e5986e..0ab57c0 100644
</span><span class="gd">--- a/Gemfile
</span><span class="gi">+++ b/Gemfile
</span><span class="p">@@ -5,6 +5,7 @@</span> gem 'middleman-aria_current'
 gem 'middleman-autoprefixer', '~&gt; 2.7'
 gem 'middleman-syntax'
 
<span class="gi">+gem 'git'
</span> gem 'redcarpet'
 gem 'tzinfo-data', platforms: [:mswin, :mingw, :jruby, :x64_mingw]
 gem 'wdm', '~&gt; 0.1', platforms: [:mswin, :mingw, :x64_mingw]
</code></pre></div></details>

              <details open>
  <summary>Gemfile.lock</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile.lock b/Gemfile.lock
index 0605a68..af87bc8 100644
</span><span class="gd">--- a/Gemfile.lock
</span><span class="gi">+++ b/Gemfile.lock
</span><span class="p">@@ -23,6 +23,8 @@</span> GEM
     fast_blank (1.0.0)
     fastimage (2.1.7)
     ffi (1.12.2)
<span class="gi">+    git (1.6.0)
+      rchardet (~&gt; 1.8)
</span>     haml (5.1.2)
       temple (&gt;= 0.8.0)
       tilt
<span class="p">@@ -88,6 +90,7 @@</span> GEM
     rb-fsevent (0.10.3)
     rb-inotify (0.10.1)
       ffi (~&gt; 1.0)
<span class="gi">+    rchardet (1.8.0)
</span>     redcarpet (3.5.0)
     rouge (3.15.0)
     sassc (2.2.1)
<span class="p">@@ -106,6 +109,7 @@</span> PLATFORMS
   ruby
 
 DEPENDENCIES
<span class="gi">+  git
</span>   middleman (~&gt; 4.2)
   middleman-aria_current
   middleman-autoprefixer (~&gt; 2.7)
</code></pre></div></details>

              <details open>
  <summary>Makefile</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Makefile b/Makefile
index 934c80d..f51f436 100644
</span><span class="gd">--- a/Makefile
</span><span class="gi">+++ b/Makefile
</span><span class="p">@@ -1,37 +1,15 @@</span>
<span class="gd">-git := git --git-dir=$${GIT_DIR-.git/}
-
-commits := $(shell mkdir -p tmp/commits &amp;&amp; find tmp/commits -name '*.txt')
-data_files := $(patsubst tmp/commits/%.txt,data/commits/%.yml,$(commits))
-
-TARGETS := \
-	$(data_files) \
-	data/history.yml \
-	source/index.html.md
-
</span> .PHONY: all clean build compile
 
<span class="gd">-all: $(TARGETS)
</span><span class="gi">+all: install compile
+
+serve: install
+	bundle exec middleman serve
</span> 
 install: Gemfile Gemfile.lock yarn.lock package.json
 	script/setup
 
<span class="gd">-compile: $(TARGETS)
</span><span class="gi">+compile: build/
</span> 	bundle exec middleman build
 
<span class="gd">-build:
-	mkdir -p tmp/commits/
-	$(git) log --format="tmp/commits/%h.txt" | xargs touch
-
</span> clean:
<span class="gd">-	rm -rf tmp source/index.* build data
-
-source/index.html.md:
-	$(git) show HEAD:README.md &gt; $@
-
-data/commits/%.yml: tmp/commits/%.txt
-	mkdir -p $(dir $@)
-	script/template-data $$(basename $&lt; .txt) &gt; $@
-
-data/history.yml:
-	mkdir -p $(dir $@)
-	script/template-history "$$($(git) log --reverse --root --format='- %h')" &gt; $@
</span><span class="gi">+	rm -rf build/
</span></code></pre></div></details>

              <details open>
  <summary>bin/git-read</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/bin/git-read b/bin/git-read
index d62bb0c..5e61c4d 100755
</span><span class="gd">--- a/bin/git-read
</span><span class="gi">+++ b/bin/git-read
</span><span class="p">@@ -2,7 +2,6 @@</span>
 
 set -e
 
<span class="gd">-export GIT_DIR=${1-.git/}
</span><span class="gi">+export GIT_DIR=${1-./}
</span> 
<span class="gd">-make clean build
-make compile
</span><span class="gi">+make
</span></code></pre></div></details>

              <details open>
  <summary>config.rb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config.rb b/config.rb
index aabe4e4..ade661b 100644
</span><span class="gd">--- a/config.rb
</span><span class="gi">+++ b/config.rb
</span><span class="p">@@ -1,3 +1,4 @@</span>
<span class="gi">+require "git"
</span> require "lib/commit_helpers"
 
 # Activate and configure extensions
<span class="p">@@ -38,16 +39,27 @@</span> page '/*.txt', layout: false
 #     which_fake_page: 'Rendering a fake page with a local variable'
 #   },
 # )
<span class="gd">-ignore "/commits/commit.html"
</span> 
<span class="gd">-data.history.commits.each do |id|
</span><span class="gi">+repository = Git.open(
+  Pathname(ENV.fetch("GIT_DIR", File.dirname(__FILE__))),
+)
+
+repository.log.reverse_each do |commit|
</span>   proxy(
<span class="gd">-    "/commits/#{id}/index.html",
</span><span class="gi">+    "/commits/#{commit.sha}/index.html",
</span>     "/commits/commit.html",
<span class="gd">-    locals: { id: id },
</span><span class="gi">+    locals: { repository: repository, commit: commit },
+    ignore: true,
</span>   )
 end
 
<span class="gi">+proxy(
+  "index.html",
+  "README.html",
+  locals: { repository: repository, readme: repository.object("HEAD:README.md") },
+  ignore: true,
+)
+
</span> # Helpers
 # Methods defined in the helpers block are available in templates
 # https://middlemanapp.com/basics/helper-methods/
</code></pre></div></details>

              <details open>
  <summary>lib/commit_helpers.rb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/lib/commit_helpers.rb b/lib/commit_helpers.rb
index 62e52c2..e50c952 100644
</span><span class="gd">--- a/lib/commit_helpers.rb
</span><span class="gi">+++ b/lib/commit_helpers.rb
</span><span class="p">@@ -1,26 +1,5 @@</span>
 module CommitHelpers
<span class="gd">-  def commit?
-    current_commit.present?
-  end
-
-  def current?(commit)
-    [
-      current_commit.id,
-      commit,
-    ].map(&amp;:to_s).uniq.size == 1
-  end
-
-  def first_commit_sha
-    data.history.commits.first
-  end
-
-  def current_commit
-    sha = current_page.data.id || yield_content(:id)
-
-    data.commits[sha]
-  end
-
</span>   def commit_path(commit)
<span class="gd">-    "/commits/#{commit}/"
</span><span class="gi">+    "/commits/#{commit.sha}/"
</span>   end
 end
</code></pre></div></details>

              <details open>
  <summary>script/template-data</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/script/template-data b/script/template-data
</span><span class="p">deleted file mode 100755
</span><span class="gh">index dd405f4..0000000
</span><span class="gd">--- a/script/template-data
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,13 +0,0 @@</span>
<span class="gd">-#!/usr/bin/env sh
-
-set -e
-
-SHA=$1
-
-export LANG=C
-export GIT_SHA=${SHA}
-export GIT_SUBJECT="$(git show --no-patch --format='%s' $SHA | sed -e 's/\"/\\"/g')"
-export GIT_MESSAGE="$(git show --no-patch --format='%b' $SHA | sed -e 's/^/  /g')"
-export GIT_DIFF="$(git show --cc --format='' $SHA | sed -e 's/^/  /g')"
-
-envsubst &lt; templates/data/commit.yml.tmpl
</span></code></pre></div></details>

              <details open>
  <summary>script/template-history</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/script/template-history b/script/template-history
</span><span class="p">deleted file mode 100755
</span><span class="gh">index 132ece7..0000000
</span><span class="gd">--- a/script/template-history
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,9 +0,0 @@</span>
<span class="gd">-#!/usr/bin/env sh
-
-set -e
-
-HISTORY=$1
-
-export GIT_HISTORY=$(echo "${HISTORY}" | sed -e 's/^/  /g')
-
-envsubst &lt; templates/data/history.yml.tmpl
</span></code></pre></div></details>

              <details open>
  <summary>source/README.html.md.erb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/README.html.md.erb b/source/README.html.md.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..537c2c2
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/source/README.html.md.erb
</span><span class="p">@@ -0,0 +1 @@</span>
<span class="gi">+&lt;%= readme.contents %&gt;
</span></code></pre></div></details>

              <details open>
  <summary>source/commits/commit.html.md.erb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/commits/commit.html.md.erb b/source/commits/commit.html.md.erb
index c470810..28763fa 100644
</span><span class="gd">--- a/source/commits/commit.html.md.erb
</span><span class="gi">+++ b/source/commits/commit.html.md.erb
</span><span class="p">@@ -1,8 +1,11 @@</span>
<span class="gd">-&lt;% content_for(:id, id) %&gt;
</span><span class="gi">+&lt;% subject, *messages = commit.message.lines %&gt;
</span> 
<span class="gd">-&lt;% content_for(:title, data.commits[id].subject) %&gt;
-
-&lt;%= data.commits[id].subject %&gt;
</span><span class="gi">+&lt;%= subject.strip %&gt;
</span> ===
 
<span class="gd">-&lt;%= data.commits[id].message %&gt;
</span><span class="gi">+&lt;%= messages.join %&gt;
+
+```diff
+&lt;%= commit.diff_parent.patch -%&gt;
+
+```
</span></code></pre></div></details>

              <details open>
  <summary>source/layouts/layout.erb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/layouts/layout.erb b/source/layouts/layout.erb
index 5f09c47..fd7b1ef 100644
</span><span class="gd">--- a/source/layouts/layout.erb
</span><span class="gi">+++ b/source/layouts/layout.erb
</span><span class="p">@@ -15,32 +15,29 @@</span>
     &lt;details id="table-of-contents" class="page__history" open&gt;
       &lt;summary class="page__history-summary"&gt;Table of Contents&lt;/summary&gt;
       &lt;nav class="history"&gt;
<span class="gd">-        &lt;% data.history.commits.each do |commit| %&gt;
-          &lt;%= current_link_to escape_html(data.commits[commit].subject), commit_path(commit) %&gt;
</span><span class="gi">+        &lt;% repository.log.reverse_each do |commit| %&gt;
+          &lt;%= current_link_to escape_html(commit.message.lines.first), commit_path(commit) %&gt;
</span>         &lt;% end %&gt;
       &lt;/nav&gt;
     &lt;/details&gt;
 
     &lt;main class="page__content"&gt;
       &lt;header&gt;
<span class="gd">-        &lt;% if commit? %&gt;
-          &lt;% ([nil] + data.history.commits).each_cons(2) do |parent, commit| %&gt;
-            &lt;% if current?(commit) &amp;&amp; parent.present? %&gt;
-              &lt;% link_to commit_path(parent) do %&gt;
-                Previous
-              &lt;% end %&gt;
</span><span class="gi">+        &lt;% if defined?(commit) %&gt;
+          &lt;% if commit.parent.present? %&gt;
+            &lt;% link_to commit_path(commit.parent) do %&gt;
+              Previous
</span>             &lt;% end %&gt;
           &lt;% end %&gt;
 
<span class="gd">-          &lt;% (data.history.commits + [nil]).each_cons(2) do |commit, child| %&gt;
-            &lt;% if current?(commit) &amp;&amp; child.present? %&gt;
-              &lt;% link_to commit_path(child) do %&gt;
-                Next
-              &lt;% end %&gt;
</span><span class="gi">+          &lt;% next_commit = repository.log.detect { |child| child.parent&amp;.sha == commit.sha } %&gt;
+          &lt;% if next_commit.present? %&gt;
+            &lt;% link_to commit_path(next_commit) do %&gt;
+              Next
</span>             &lt;% end %&gt;
           &lt;% end %&gt;
         &lt;% else %&gt;
<span class="gd">-          &lt;% link_to(commit_path(first_commit_sha)) do %&gt;
</span><span class="gi">+          &lt;% link_to(commit_path(repository.log.last)) do %&gt;
</span>             Get Started
           &lt;% end %&gt;
         &lt;% end %&gt;
<span class="p">@@ -49,13 +46,6 @@</span>
       &lt;article class="commit"&gt;
         &lt;%= yield %&gt;
       &lt;/article&gt;
<span class="gd">-
-      &lt;% if commit? %&gt;
-&lt;!-- Lack of Leading Whitespace is Significant --&gt;
-&lt;% code("diff") do %&gt;
-&lt;%= current_commit.diff %&gt;
-&lt;% end %&gt;
-      &lt;% end %&gt;
</span>     &lt;/main&gt;
   &lt;/body&gt;
 &lt;/html&gt;
</code></pre></div></details>

              <details open>
  <summary>templates/data/commit.yml.tmpl</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/data/commit.yml.tmpl b/templates/data/commit.yml.tmpl
</span><span class="p">deleted file mode 100644
</span><span class="gh">index 239d160..0000000
</span><span class="gd">--- a/templates/data/commit.yml.tmpl
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,7 +0,0 @@</span>
<span class="gd">----
-id: "${GIT_SHA}"
-subject: "${GIT_SUBJECT}"
-message: |
-${GIT_MESSAGE}
-diff: |
-${GIT_DIFF}
</span></code></pre></div></details>

              <details open>
  <summary>templates/data/history.yml.tmpl</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/data/history.yml.tmpl b/templates/data/history.yml.tmpl
</span><span class="p">deleted file mode 100644
</span><span class="gh">index f598bf4..0000000
</span><span class="gd">--- a/templates/data/history.yml.tmpl
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,2 +0,0 @@</span>
<span class="gd">-commits:
-${GIT_HISTORY}
</span></code></pre></div></details>

      </article>
    </main>
  </body>
</html>
