<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Render the contents of a Commit's Message</title>
    <script src="../../javascripts/site.js"></script>
    <link href="../../stylesheets/syntax.css" rel="stylesheet" />
  </head>
  <body class="min-h-screen">
    <header class="flex flex-row h-12 border-b">
      <h1 class="flex items-center justify-center w-full md:border-r md:w-96">
<a href="/git-read/index.html">          git-read
</a>      </h1>

      <nav class="flex flex-grow justify-between items-center border-t p-3 fixed inset-x-0 bottom-0 bg-white z-10 md:px-4 md:py-0 md:bg-transparent md:border-0 md:relative">

<a href="/git-read/commits/6d38b4dc08ed6e7495bba57c091d5571570998ef/index.html">              &#8592; Previous
</a>
          <span class="flex-grow"><!-- ensure the links are pushed to the container's extremes --></span>

<a href="/git-read/commits/53aff71d2d7f407e32599da7b57946b4626a5d32/index.html">              Next &#8594;
</a>      </nav>
    </header>

    <main class="flex flex-col md:flex-row">
      <details id="navigation" class="relative pb-8 md:h-screen-fit" data-turbolinks-permanent>
        <summary class="cursor-pointer inset-0 top-auto list-none outline-none md:relative">
          <span class="sr-only open:hidden">Expand History</span>
          <span class="sr-only hidden open:initial">Collapse History</span>
          <div class="md:h-screen-fit flex flex-col border-b border-t h-8 w-full justify-center md:w-8 md:border-r md:border-l md:border-t-0 open:absolute inset-x-0 bottom-0 top-auto md:top-0 md:left-auto">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="transform rotate-90 open:-rotate-90 md:rotate-0 md:open:rotate-180">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

          </div>
        </summary>

        <nav class="flex flex-col px-4 my-4 overflow-y-auto h-48 w-screen current-within:font-bold md:h-screen-fit md:w-96 md:my-auto md:p-2 md:pr-10 md:space-y-2">
<a href="/git-read/commits/b569a6e924f814f61e4abab68583509b3f07d5de/index.html">              <p>[GENERATED]: Scaffold the project with Middleman</p>

</a><a href="/git-read/commits/dbc622945b1bddf16efdc03a2406269f453f8715/index.html">              <p>Elaborate on the project&#39;s goals in the README.md</p>

</a><a href="/git-read/commits/bf43ccf18bce2ef85031a550b6459a062748ad98/index.html">              <p>Add webpack for managing assets</p>

</a><a href="/git-read/commits/4b5836dd53627297d5b6310c4a6f0d85840c466b/index.html">              <p>Install Tailwind</p>

</a><a href="/git-read/commits/b91d54dd5036a8ce69999af75fe6126102fcaac9/index.html">              <p>Replace Generated Files with Static HTML and CSS</p>

</a><a href="/git-read/commits/e1c885cc55a675f138db8185159b430aab71e9cf/index.html">              <p>Exercise the application through a System Test</p>

</a><a href="/git-read/commits/a002785d225f38277dbe736a29a815662b073c6f/index.html">              <p>Introduce Redcarpet Markdown Engine</p>

</a><a href="/git-read/commits/7f5d26388b905159321686ff630bb036d6d7e12f/index.html">              <p>Generate <code>/index.html</code> dynamically</p>

</a><a href="/git-read/commits/6d38b4dc08ed6e7495bba57c091d5571570998ef/index.html">              <p>Extract <code>ApplicationSystemTestCase</code></p>

</a><a href="/git-read/commits/1d9e32b3260f02c3b433b1103daf0ee8034bdeb7/index.html">              <p>Render the contents of a Commit&#39;s Message</p>

</a><a href="/git-read/commits/53aff71d2d7f407e32599da7b57946b4626a5d32/index.html">              <p>Navigate to previous commit</p>

</a><a href="/git-read/commits/8cf026425cd18a306023b9db81584603ce6f2454/index.html">              <p>Navigate to next commit</p>

</a><a href="/git-read/commits/df2e83a5e4715d17ddbd06ba533171426f7200b4/index.html">              <p>Dynamically determine project title</p>

</a><a href="/git-read/commits/0e4e5b9a6a52fd9036fff968561361b001881bba/index.html">              <p>Extract <code>UrlHelpers</code></p>

</a><a href="/git-read/commits/876195313464b78ac280a8fc8b4e986008b0acb4/index.html">              <p>Add &quot;current&quot; styles to <code>&lt;a&gt;</code> elements</p>

</a><a href="/git-read/commits/dcd4cdb09c63378dfd48d48efc98ee9fc93f047c/index.html">              <p>Syntax highlight Markdown fenced code blocks</p>

</a><a href="/git-read/commits/3017c39a1ec734f6cdd280b5bba62150fe1f75ca/index.html">              <p>Introduce <code>bin/git-read</code> command line interface</p>

</a><a href="/git-read/commits/f090e69a9c4d5ce3d58c99b7218e3d60fc4f6103/index.html">              <p>Add <code>bin/git-read --server</code> flag</p>

</a><a href="/git-read/commits/fb1536eccf2f5618de871cf85c4cac35c8143f64/index.html">              <p>Extract <code>GitHelpers</code> from System Test Cases</p>

</a><a href="/git-read/commits/9419d14e977e162ad14e94c1e7e01936e3c65299/index.html">              <p>Add support for re-writing a project&#39;s history</p>

</a><a href="/git-read/commits/201816ad26cc51c2dd298bd95e82df41dc995bfe/index.html">              <p>Extract <code>Commit</code> model</p>

</a><a href="/git-read/commits/06969aa4ff82b17cdb12fb0e08bda346c7fb2d52/index.html">              <p>Render how a commit changes the project&#39;s files</p>

</a><a href="/git-read/commits/f9e486cbf8d90e12cca64758fa607615f50b85d4/index.html">              <p>Extract SVG images</p>

</a><a href="/git-read/commits/9c1da72abeeac1beef2e1f05fbe157da86c7a4e4/index.html">              <p>Get Started from README skipping generated commits</p>

</a><a href="/git-read/commits/ad791e1df7c6e6a1246636accac242048b17e0aa/index.html">              <p>Add <code>&lt;details&gt;</code> element polyfill</p>

</a><a href="/git-read/commits/fca5220bc2e81a7c3deab87b6d4ff9244868cc21/index.html">              <p>Navigate with Turbolinks</p>

</a><a href="/git-read/commits/8bd8299978799dff93e122f61b023afe3b3e8f19/index.html">              <p>Integrate with GitHub Actions</p>

</a>        </nav>
      </details>

      <article class="flex-grow p-4 md:flex md:justify-center md:h-screen-fit md:p-8 md:overflow-y-auto lg:w-7/12">
        <section class="prose prose-lg md:prose-xl">

          <h1 id="render-the-contents-of-a-commits-message">Render the contents of a Commit&rsquo;s Message</h1>

<p>A Git commit message follows a <a href="https://commit.style/">loose structure</a>:</p>

<blockquote>
<p>The first line of a commit message serves as a summary.  When
displayed on the web, it&rsquo;s often styled as a heading, and in emails,
it&rsquo;s typically used as the subject.  As such, you should capitalize
it and omit any trailing punctuation.  Aim for about 50 characters,
give or take, otherwise it may be painfully truncated in some
contexts.</p>

<p>Oftentimes a subject by itself is sufficient.  When it&rsquo;s not, add a
blank line (this is important) followed by one or more paragraphs hard
wrapped to 72 characters.</p>
</blockquote>

<p>Assuming that the commits adhere to that convention, the application
will split out the commit&rsquo;s subject line from the rest of the message,
and treat it as the resulting HTML page&rsquo;s title.</p>

<p>The call to <code>subject.strip</code> in the <code>source/commits/commit</code> template is
deliberate and important. Without it, a trailing new-line character
would separate the title from its underlining <code>===</code> syntax, which would
signal to the Markdown generator that it was to be represented as a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p"><code>&lt;p&gt;</code> element`</a> instead of an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements"><code>&lt;h1&gt;</code> element</a>.</p>

<h2 id="navigating-the-history">Navigating the history</h2>

<p>Both the <code>/index.html</code> and specific <code>/commits/$SHA/index.html</code> pages
render the project&rsquo;s history in a navigable sidebar. To power this
feature, and to ensure that the data is shared across <a href="https://middlemanapp.com/advanced/dynamic-pages#defining-proxies">Middleman&rsquo;s proxy
templates</a>, extract a <a href="#config.rb"><code>config.rb</code></a>-local variable,
which is declared and shared by <a href="https://ruby-doc.org/core-2.7.0/Hash.html#method-i-merge">merging in additional template local
variables</a> as the <a href="https://middlemanapp.com/basics/partials/"><code>local:</code> key</a>.</p>

<p>The history is meant to be read start-to-finish (as opposed to the
typical latest-to-first output that a default <a href="https://www.git-scm.com/docs/git-log"><code>git log</code></a> call
provides).</p>

<p>To achieve this order, extract the <a href="#lib/models/history.rb"><code>History</code></a>
and declare the <code>#commits</code> method which chains a call to
<a href="https://ruby-doc.org/core-2.7.0/Enumerable.html#method-i-reverse_each"><code>Enumerable#reverse_each</code></a> onto calls to
<code>repository.log</code>. The <code>Repository#log</code> method receives a limit on the
number of commits to provide. We want the full history, so we pass
<code>nil</code>.</p>

<p>There are times when a commit&rsquo;s subject line contains Markdown that we
<em>do not</em> want to inline as raw HTML. To support this, wrap the
navigation item&rsquo;s text in calls to the new <code>#markdown</code> helper declared
within <a href="#config.rb"><code>config.rb</code></a>. This helper utilizes the underlying
<a href="https://middlemanapp.com/basics/templating-language/">Markdown engine that Middleman has registered</a> with
<a href="https://github.com/rtomayko/tilt/tree/v2.0.10#template-mappings"><code>Tilt</code></a>.</p>

        </section>
      </article>

        <aside class="md:h-screen-fit md:overflow-y-auto lg:w-5/12">
            <details id="config.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">config.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config.rb b/config.rb
index 8b5c22c..74a2a47 100644
</span><span class="gd">--- a/config.rb
</span><span class="gi">+++ b/config.rb
</span><span class="p">@@ -41,12 +41,29 @@</span> repository = Git.open(repository_directory)
 
 history = History.new(
   readme: repository.show("HEAD:README.md"),
<span class="gi">+  repository: repository,
</span> )
 
<span class="gi">+history.commits.each do |commit|
+  proxy(
+    "/commits/#{commit.sha}/index.html",
+    "/commits/commit.html",
+    locals: {
+      history: history,
+      commit: commit,
+      page: {
+        title: commit.message.lines.first,
+      }
+    },
+    ignore: true,
+  )
+end
+
</span> proxy(
   "index.html",
   "README.html",
   locals: {
<span class="gi">+    history: history,
</span>     contents: history.readme,
     page: {
       title: history.readme.lines.first,
<span class="p">@@ -65,6 +82,14 @@</span> proxy(
 #   end
 # end
 
<span class="gi">+helpers do
+  def markdown(content)
+    template = Tilt[:md].new { content }
+
+    template.render
+  end
+end
+
</span> # Build-specific configuration
 # https://middlemanapp.com/advanced/configuration/#environment-specific-settings
 
</code></pre></div></details>

            <details id="lib/models/history.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">lib/models/history.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/lib/models/history.rb b/lib/models/history.rb
index b93a2e5..32db695 100644
</span><span class="gd">--- a/lib/models/history.rb
</span><span class="gi">+++ b/lib/models/history.rb
</span><span class="p">@@ -1,7 +1,12 @@</span>
 class History
<span class="gd">-  attr_reader :readme
</span><span class="gi">+  attr_reader :readme, :repository
</span> 
<span class="gd">-  def initialize(readme:)
</span><span class="gi">+  def initialize(readme:, repository:)
</span>     @readme = readme
<span class="gi">+    @repository = repository
+  end
+
+  def commits
+    repository.log(nil).reverse_each
</span>   end
 end
</code></pre></div></details>

            <details id="source/commits/commit.html.md.erb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">source/commits/commit.html.md.erb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/commits/commit.html.md.erb b/source/commits/commit.html.md.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..b05055b
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/source/commits/commit.html.md.erb
</span><span class="p">@@ -0,0 +1,6 @@</span>
<span class="gi">+&lt;% subject, *messages = commit.message.lines %&gt;
+
+&lt;%= subject.strip %&gt;
+===
+
+&lt;%= messages.join %&gt;
</span></code></pre></div></details>

            <details id="source/layouts/layout.erb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">source/layouts/layout.erb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/layouts/layout.erb b/source/layouts/layout.erb
index 1b7ede5..26f02f2 100644
</span><span class="gd">--- a/source/layouts/layout.erb
</span><span class="gi">+++ b/source/layouts/layout.erb
</span><span class="p">@@ -40,13 +40,11 @@</span>
         &lt;/summary&gt;
 
         &lt;nav class="flex flex-col px-4 my-4 overflow-y-auto h-48 w-screen md:h-screen-fit md:w-96 md:my-auto md:p-2 md:pr-10 md:space-y-2"&gt;
<span class="gd">-          &lt;a href="#"&gt;
-            [GENERATED]: Scaffold the project with Middleman
-          &lt;/a&gt;
-
-          &lt;a href="#"&gt;
-            Elaborate on the project's goals in the README.md
-          &lt;/a&gt;
</span><span class="gi">+          &lt;% history.commits.each do |commit| %&gt;
+            &lt;% link_to("/commits/#{commit.sha}/index.html") do %&gt;
+              &lt;%= markdown(commit.message.lines.first) %&gt;
+            &lt;% end %&gt;
+          &lt;% end %&gt;
</span>         &lt;/nav&gt;
       &lt;/details&gt;
 
</code></pre></div></details>

            <details id="test/application_system_test_case.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">test/application_system_test_case.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/application_system_test_case.rb b/test/application_system_test_case.rb
index dd46a69..5a36271 100644
</span><span class="gd">--- a/test/application_system_test_case.rb
</span><span class="gi">+++ b/test/application_system_test_case.rb
</span><span class="p">@@ -44,6 +44,10 @@</span> class ApplicationSystemTestCase &lt; ActiveSupport::TestCase
     end
   end
 
<span class="gi">+  def expand_history
+    find("details &gt; summary", text: "Expand History").click
+  end
+
</span>   teardown do
     Capybara.reset_sessions!
     Capybara.use_default_driver
</code></pre></div></details>

            <details id="test/system/visitor_views_commits_test.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">test/system/visitor_views_commits_test.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/visitor_views_commits_test.rb b/test/system/visitor_views_commits_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..6b243aa
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/system/visitor_views_commits_test.rb
</span><span class="p">@@ -0,0 +1,34 @@</span>
<span class="gi">+require "application_system_test_case"
+
+class VisitorViewsCommitsTest &lt; ApplicationSystemTestCase
+  test "visitor views commits" do
+    stage_file("README.md", "Ignore me")
+    commit("Ignore me")
+    stage_file("file.txt", "Ignore me")
+    commit(&lt;&lt;~MARKDOWN)
+    The commit subject
+
+    The commit body
+    MARKDOWN
+
+    with_git_repository do
+      visit "/index.html"
+      expand_history
+      click_on "The commit subject"
+
+      assert_selector "h1", text: "The commit subject"
+      assert_selector "p", text: "The commit body"
+    end
+  end
+
+  test "visitor views commit with HTML in the subject line" do
+    stage_file("README.md", "Ignore me")
+    commit("This subject has a `&lt;h1&gt;` in it")
+
+    with_git_repository do
+      visit "/index.html"
+
+      assert_text "This subject has a &lt;h1&gt; in it"
+    end
+  end
+end
</span></code></pre></div></details>

        </aside>
    </main>
  </body>
</html>
