<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>generate data, don't generate templates</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" data-turbolinks-track="reload" />
    <link href="../../stylesheets/syntax.css" rel="stylesheet" data-turbolinks-track="reload" />
    <script src="../../main.js" data-turbolinks-track="reload"></script>
  </head>
  <body class="page">
    <details id="table-of-contents" class="page__history" open>
      <summary class="page__history-summary">Table of Contents</summary>
      <nav class="history">
        <a href="../../">git-read</a>

          <a href="../5d59b45ece450d98e2c4149b9db57bc1e4a9041f/">Ensure `tmp&#x2F;` and `source&#x2F;` directories exist
</a>
          <a href="../42a35c8343ae3ed962c3b21f62e1ec917ce34eec/">Introduce `Makefile`
</a>
          <a href="../87314ace144e16df7dba371f5106ec669f41aa17/">Created `README.md`
</a>
          <a href="../11f450c4b9b84d5d248dfcea206e34a4d8fb78c2/">Create the `.gitignore` file
</a>
          <a href="../43e0f6109cf2640ca94f90adf30a49de0b4c45d9/">template things out</a>
          <a href="../1966ee21ea7ad0dafeea2e930090fa3833c8514e/">generate more data</a>
          <a href="../c96f22474b8ae1153843de9c5262479a4c362626/">make available in other git directory</a>
          <a href="../dd647ec9cf6dc7c70a05b3896a464fda75113999/">current README, fix data file</a>
          <a href="../af567ecfe89778417d201afdb21d066ab21005d3/">move partial to top level template</a>
          <a href="../32a94acaae522a307bb2e83c3e4d197812b36609/">include CSS from Syntax highlighting</a>
          <a href="../aa6a082747a63d8daa51b3cffbfb15890e5b5e3a/">Install `bitters` for base styles
</a>
          <a href="../e9eda25546b8a590fac97a6de1ec9823a42fc888/">start to style page</a>
          <a href="../f83e06a9192e77bfaf8c66d8c33384ee68282193/">Prepare to generate JavaScript with Make</a>
          <a href="../11ccf674d47028ee591149134ea1b8c2eb28024a/">build JavaScript assets with Make</a>
          <a href="../532b5734e3b10910123cf899bc097c8ece44b749/">install Turbolinks, bundle with webpack</a>
          <a href="../93187d4cfbd11eb151de1685a770ecf72365f35b/">streamline Makefile</a>
          <a href="../e52955299c3c900a20d8e153c9be17069dca7c5c/">start to style layout</a>
          <a href="../f9d59463eccada46f3089f226ec6b787f877b4a9/">introduce CommitHelpers
</a>
          <a href="../13df0b4af96c16f7e021eb7fbb25ea79ccea471c/">more styling</a>
          <a href="../2aaa7efa50385d8983c28272dcf4233d1c4e9957/">Introduce `bin&#x2F;git-read`
</a>
          <a href="../03b2b6a853548bc7321e6018ce08ee44e5a74fa0/">make history collapsible on mobile</a>
          <a href="../63110797e2ae4d436da0839e56b60ff3f04a47bd/">Restore default `ul` and `ol` within Markdown
</a>
          <a href="../8f80bdd482310d51c9493e1dc75ce6b94f33d3d0/">Add &quot;current&quot; styles to `&lt;a&gt;` elements
</a>
          <a href="../5e6606a521316b80384903080d5cfdfc4c688343/">fixup JS&#x2F;webpack, external pipelines</a>
          <a href="./" aria-current="page">generate data, don&#x27;t generate templates</a>
          <a href="../23ea6e6eef66f47579380e27bcdea4617fb3b67a/">Improve installation and cross-platform capabilities</a>
          <a href="../04020914d6e90696220867eed07b4f361dab0127/">Make your life easier with `ruby-git`
</a>
          <a href="../ce8d2db85a79d0acea721fb9c572102e8252025f/">improve setup</a>
          <a href="../319fb52a8833df9f36c31f3508e1a0e1997568da/">workflow</a>
          <a href="../ac343c8b674197a76aa02cf4596ac7b335fca9b5/">parallelize, cache</a>
          <a href="../f2ca94be72c920820b0f6830c48e8a9b2dc13a04/">combine calls to make</a>
          <a href="../5b66b59687169a79cf5ff8e606763cdd1c4e8e52/">fetch SHAs</a>
          <a href="../e216028c90ac13e9bd00abb412def411cead51dc/">minimize output, try and get whole tree</a>
          <a href="../92dc79b152dbb924565d533bf653238e49c01eca/">move files around after building</a>
          <a href="../79d2aa7bf8632500ff72b7aa0dbd1105ee850a66/">include Gemfile.lock for caching</a>
          <a href="../a3261a4a1f7c03e6cdae192d781bac32c63b301b/">build without cache</a>
          <a href="../d45d05f7dda519945cfe8b1b6de1ef523b28e6cf/">publish with different Action</a>
          <a href="../f10c24c94183013b17a22c8d348682fffa658347/">import assets relatively</a>
          <a href="../1abe4d0b0560fd6561fbc015c061e4340f90ad2d/">add caching back</a>
          <a href="../b2c8bc4325f38c8605bd400cc0d6056b32dfbfcb/">bust Gemfile cache, use relative links</a>
          <a href="../37c8d237d1821ac5255b0dc493dd0b07b189311b/">integrate with sitemap</a>
          <a href="../4de4aed13cdd07ee8de9e421f31249023bc8f218/">make it relative</a>
          <a href="../e19722f077e0c9df4c232229ae69534b4b50cb2d/">properly call no limit on git log</a>
          <a href="../31826742a47eecc7666a32dfc81643b55e5bebb1/">bust cache</a>
          <a href="../d19b75814f4a66e2ec2bc1a49b4226e71352376b/">sync ruby versions</a>
          <a href="../8ceee65d0eeb9c029b56d0a502d32aa5cba58db2/">do not cache</a>
          <a href="../88630325e3adad1b4f6922d9c66270d0953a63c8/">add back caching, use sitemap branch of current</a>
          <a href="../a08ee4e2c6f42e34749e903815054950d9569ab5/">Add link to project root</a>
          <a href="../406938f2d1f25bb6c83353df84718db343421b84/">configure command to take git directory and output</a>
          <a href="../63d6e19355548a1c9ccb389cfcb3e326339ae1ad/">improve spacing</a>
          <a href="../b2e8cd2780b51aa41ad60922e73231007c89b963/">WIP</a>
          <a href="../f9d2e835af4ec5454876b02a604f88f372f8c43b/">Render files when initial commit</a>
          <a href="../e775a2985b99a0b02bfa566943b351269271c1c1/">memoize</a>
          <a href="../90a9873b074ffca4def61bd176a33c099bdef501/">extend the `bin&#x2F;git-read` command to take flags:
</a>
          <a href="../0acb182e86da666baad5e41388bf1e55ebe01d68/">don&#x27;t peg to Ruby version</a>
          <a href="../e4f3451f10170b510e5f9cade1d8dc1185f61c85/">make executable account for being run from elsewhere</a>
          <a href="../9f9fb88e9c29dd1bc30cd92d48ebd797adc45c81/">don&#x27;t use realpath on OUTPUT_DIR, it doesn&#x27;t exist</a>
          <a href="../96966fce5ddfe2e9ed89b915fad7f0f10f014782/">only run on pushes to master</a>
          <a href="../cebc9db90d27697e3dbf5566548201e259a6e602/">don&#x27;t tie to specific bundler version</a>
          <a href="../8c0a95be2d3ea0e73b9b918e3bb445a9c22b7082/">make arguments flexible, resolve with realpath</a>
          <a href="../459485710e02f2b4c73e5897c17c2e261b81a179/">page title and make `--serve` work</a>
      </nav>
    </details>

    <main class="page__content">
      <header class="navigation">

<a href="../5e6606a521316b80384903080d5cfdfc4c688343/">              &#8592; Previous
</a>
<a href="../23ea6e6eef66f47579380e27bcdea4617fb3b67a/">              Next &#8594;
</a>      </header>

      <article class="commit">
        <h1>generate data, don&rsquo;t generate templates</h1>



              <details open>
  <summary>.gitignore</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/.gitignore b/.gitignore
index 13b6a11..501019d 100644
</span><span class="gd">--- a/.gitignore
</span><span class="gi">+++ b/.gitignore
</span><span class="p">@@ -2,8 +2,7 @@</span> dist/
 build/
 tmp/
 source/index.html.*
<span class="gd">-source/commits/*
-data/*
</span><span class="gi">+/data/
</span> 
 .bundle
 .cache
</code></pre></div></details>

              <details open>
  <summary>Makefile</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Makefile b/Makefile
index d7592f6..2d7f723 100644
</span><span class="gd">--- a/Makefile
</span><span class="gi">+++ b/Makefile
</span><span class="p">@@ -1,12 +1,11 @@</span>
 git := git --git-dir=$${GIT_DIR-.git/}
 
 commits := $(shell mkdir -p tmp/commits &amp;&amp; find tmp/commits -name '*.txt')
<span class="gd">-source_files := $(patsubst tmp/commits/%.txt,source/commits/%/index.html.md,$(commits))
-diff_files := $(patsubst tmp/commits/%.txt,source/commits/%/_diff.html,$(commits))
</span><span class="gi">+data_files := $(patsubst tmp/commits/%.txt,data/commits/%.yml,$(commits))
</span> 
 TARGETS := \
<span class="gd">-	$(source_files) \
-	$(diff_files) \
</span><span class="gi">+	$(data_files) \
+	data/history.yml \
</span> 	source/index.html.md
 
 .PHONY: all clean build compile
<span class="p">@@ -21,21 +20,15 @@</span> build:
 	$(git) log --format="tmp/commits/%h.txt" | xargs touch
 
 clean:
<span class="gd">-	rm -rf tmp source/{commits,index.*} build data
</span><span class="gi">+	rm -rf tmp source/index.* build data
</span> 
<span class="gd">-node_modules: package.json yarn.lock
-	yarn install
-
-source/index.html.md: data/commits.yml
</span><span class="gi">+source/index.html.md:
</span> 	$(git) show HEAD:README.md &gt; $@
 
<span class="gd">-data/commits.yml:
</span><span class="gi">+data/commits/%.yml: tmp/commits/%.txt
</span> 	mkdir -p $(dir $@)
<span class="gd">-	echo "sequence:\n$$($(git) log --reverse --format="$$(cat templates/commit.yml)")" &gt; data/commits.yml
-
-source/commits/%/_diff.html: tmp/commits/%.txt
-	$(git) show --cc --format="" $$(basename $&lt; .txt) --output=$@
</span><span class="gi">+	script/template-data $$(basename $&lt; .txt) &gt; $@
</span> 
<span class="gd">-source/commits/%/index.html.md: tmp/commits/%.txt
</span><span class="gi">+data/history.yml:
</span> 	mkdir -p $(dir $@)
<span class="gd">-	$(git) show --no-patch --output=$@ --format="$$(cat templates/commit.md)" $$(basename $&lt; .txt)
</span><span class="gi">+	script/template-history "$$($(git) log --reverse --root --format='- %h')" &gt; $@
</span></code></pre></div></details>

              <details open>
  <summary>config.rb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config.rb b/config.rb
index 27281f5..aabe4e4 100644
</span><span class="gd">--- a/config.rb
</span><span class="gi">+++ b/config.rb
</span><span class="p">@@ -38,6 +38,15 @@</span> page '/*.txt', layout: false
 #     which_fake_page: 'Rendering a fake page with a local variable'
 #   },
 # )
<span class="gi">+ignore "/commits/commit.html"
+
+data.history.commits.each do |id|
+  proxy(
+    "/commits/#{id}/index.html",
+    "/commits/commit.html",
+    locals: { id: id },
+  )
+end
</span> 
 # Helpers
 # Methods defined in the helpers block are available in templates
</code></pre></div></details>

              <details open>
  <summary>lib/commit_helpers.rb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/lib/commit_helpers.rb b/lib/commit_helpers.rb
index 129e0e2..62e52c2 100644
</span><span class="gd">--- a/lib/commit_helpers.rb
</span><span class="gi">+++ b/lib/commit_helpers.rb
</span><span class="p">@@ -1,16 +1,26 @@</span>
 module CommitHelpers
   def commit?
<span class="gd">-    current_page.data.id.present?
</span><span class="gi">+    current_commit.present?
</span>   end
 
   def current?(commit)
     [
<span class="gd">-      current_page.data.id,
-      commit.id
</span><span class="gi">+      current_commit.id,
+      commit,
</span>     ].map(&amp;:to_s).uniq.size == 1
   end
 
<span class="gi">+  def first_commit_sha
+    data.history.commits.first
+  end
+
+  def current_commit
+    sha = current_page.data.id || yield_content(:id)
+
+    data.commits[sha]
+  end
+
</span>   def commit_path(commit)
<span class="gd">-    "/commits/#{commit.id}/"
</span><span class="gi">+    "/commits/#{commit}/"
</span>   end
 end
</code></pre></div></details>

              <details open>
  <summary>script/template-data</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/script/template-data b/script/template-data
</span><span class="p">new file mode 100755
</span><span class="gh">index 0000000..dd405f4
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/script/template-data
</span><span class="p">@@ -0,0 +1,13 @@</span>
<span class="gi">+#!/usr/bin/env sh
+
+set -e
+
+SHA=$1
+
+export LANG=C
+export GIT_SHA=${SHA}
+export GIT_SUBJECT="$(git show --no-patch --format='%s' $SHA | sed -e 's/\"/\\"/g')"
+export GIT_MESSAGE="$(git show --no-patch --format='%b' $SHA | sed -e 's/^/  /g')"
+export GIT_DIFF="$(git show --cc --format='' $SHA | sed -e 's/^/  /g')"
+
+envsubst &lt; templates/data/commit.yml.tmpl
</span></code></pre></div></details>

              <details open>
  <summary>script/template-history</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/script/template-history b/script/template-history
</span><span class="p">new file mode 100755
</span><span class="gh">index 0000000..132ece7
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/script/template-history
</span><span class="p">@@ -0,0 +1,9 @@</span>
<span class="gi">+#!/usr/bin/env sh
+
+set -e
+
+HISTORY=$1
+
+export GIT_HISTORY=$(echo "${HISTORY}" | sed -e 's/^/  /g')
+
+envsubst &lt; templates/data/history.yml.tmpl
</span></code></pre></div></details>

              <details open>
  <summary>source/commits/commit.html.md.erb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/commits/commit.html.md.erb b/source/commits/commit.html.md.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..c470810
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/source/commits/commit.html.md.erb
</span><span class="p">@@ -0,0 +1,8 @@</span>
<span class="gi">+&lt;% content_for(:id, id) %&gt;
+
+&lt;% content_for(:title, data.commits[id].subject) %&gt;
+
+&lt;%= data.commits[id].subject %&gt;
+===
+
+&lt;%= data.commits[id].message %&gt;
</span></code></pre></div></details>

              <details open>
  <summary>source/layouts/layout.erb</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/layouts/layout.erb b/source/layouts/layout.erb
index 0b28696..5f09c47 100644
</span><span class="gd">--- a/source/layouts/layout.erb
</span><span class="gi">+++ b/source/layouts/layout.erb
</span><span class="p">@@ -6,7 +6,7 @@</span>
     &lt;meta name="viewport"
           content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
     &lt;!-- Use the title from a page's frontmatter if it has one --&gt;
<span class="gd">-    &lt;title&gt;&lt;%= current_page.data.title || "Middleman" %&gt;&lt;/title&gt;
</span><span class="gi">+    &lt;title&gt;&lt;%= current_page.data.title || yield_content(:title) || "git-read" %&gt;&lt;/title&gt;
</span>     &lt;%= stylesheet_link_tag "site", "data-turbolinks-track": "reload" %&gt;
     &lt;%= stylesheet_link_tag "syntax", "data-turbolinks-track": "reload" %&gt;
     &lt;%= javascript_include_tag "main", "data-turbolinks-track": "reload" %&gt;
<span class="p">@@ -15,8 +15,8 @@</span>
     &lt;details id="table-of-contents" class="page__history" open&gt;
       &lt;summary class="page__history-summary"&gt;Table of Contents&lt;/summary&gt;
       &lt;nav class="history"&gt;
<span class="gd">-        &lt;% data.commits.sequence.each do |commit| %&gt;
-          &lt;%= current_link_to escape_html(commit.subject), commit_path(commit) %&gt;
</span><span class="gi">+        &lt;% data.history.commits.each do |commit| %&gt;
+          &lt;%= current_link_to escape_html(data.commits[commit].subject), commit_path(commit) %&gt;
</span>         &lt;% end %&gt;
       &lt;/nav&gt;
     &lt;/details&gt;
<span class="p">@@ -24,7 +24,7 @@</span>
     &lt;main class="page__content"&gt;
       &lt;header&gt;
         &lt;% if commit? %&gt;
<span class="gd">-          &lt;% ([nil] + data.commits.sequence).each_cons(2) do |parent, commit| %&gt;
</span><span class="gi">+          &lt;% ([nil] + data.history.commits).each_cons(2) do |parent, commit| %&gt;
</span>             &lt;% if current?(commit) &amp;&amp; parent.present? %&gt;
               &lt;% link_to commit_path(parent) do %&gt;
                 Previous
<span class="p">@@ -32,7 +32,7 @@</span>
             &lt;% end %&gt;
           &lt;% end %&gt;
 
<span class="gd">-          &lt;% (data.commits.sequence + [nil]).each_cons(2) do |commit, child| %&gt;
</span><span class="gi">+          &lt;% (data.history.commits + [nil]).each_cons(2) do |commit, child| %&gt;
</span>             &lt;% if current?(commit) &amp;&amp; child.present? %&gt;
               &lt;% link_to commit_path(child) do %&gt;
                 Next
<span class="p">@@ -40,7 +40,7 @@</span>
             &lt;% end %&gt;
           &lt;% end %&gt;
         &lt;% else %&gt;
<span class="gd">-          &lt;% link_to(commit_path(data.commits.sequence.first)) do %&gt;
</span><span class="gi">+          &lt;% link_to(commit_path(first_commit_sha)) do %&gt;
</span>             Get Started
           &lt;% end %&gt;
         &lt;% end %&gt;
<span class="p">@@ -53,7 +53,7 @@</span>
       &lt;% if commit? %&gt;
 &lt;!-- Lack of Leading Whitespace is Significant --&gt;
 &lt;% code("diff") do %&gt;
<span class="gd">-&lt;%= partial("commits/#{current_page.data.id}/diff.html") %&gt;
</span><span class="gi">+&lt;%= current_commit.diff %&gt;
</span> &lt;% end %&gt;
       &lt;% end %&gt;
     &lt;/main&gt;
</code></pre></div></details>

              <details open>
  <summary>templates/commit.md</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/commit.md b/templates/commit.md
</span><span class="p">deleted file mode 100644
</span><span class="gh">index 3e64aed..0000000
</span><span class="gd">--- a/templates/commit.md
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,9 +0,0 @@</span>
<span class="gd">----
-title: %s
-id: "%h"
----
-
-%s
-===
-
-%b
</span></code></pre></div></details>

              <details open>
  <summary>templates/commit.yml</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/commit.yml b/templates/commit.yml
</span><span class="p">deleted file mode 100644
</span><span class="gh">index 2971ef5..0000000
</span><span class="gd">--- a/templates/commit.yml
</span><span class="gi">+++ /dev/null
</span><span class="p">@@ -1,3 +0,0 @@</span>
<span class="gd">-  -
-   id: "%h"
-   subject: %s
</span></code></pre></div></details>

              <details open>
  <summary>templates/data/commit.yml.tmpl</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/data/commit.yml.tmpl b/templates/data/commit.yml.tmpl
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..239d160
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/data/commit.yml.tmpl
</span><span class="p">@@ -0,0 +1,7 @@</span>
<span class="gi">+---
+id: "${GIT_SHA}"
+subject: "${GIT_SUBJECT}"
+message: |
+${GIT_MESSAGE}
+diff: |
+${GIT_DIFF}
</span></code></pre></div></details>

              <details open>
  <summary>templates/data/history.yml.tmpl</summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/templates/data/history.yml.tmpl b/templates/data/history.yml.tmpl
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..f598bf4
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/data/history.yml.tmpl
</span><span class="p">@@ -0,0 +1,2 @@</span>
<span class="gi">+commits:
+${GIT_HISTORY}
</span></code></pre></div></details>

      </article>
    </main>
  </body>
</html>
