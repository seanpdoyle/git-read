<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Render the contents of a Commit's Message</title>
    <script src="../../../javascripts/site.js"></script>
    <link href="../../../stylesheets/syntax.css" rel="stylesheet" />
  </head>
  <body class="min-h-screen">
    <header class="flex flex-row h-12 border-b">
      <h1 class="flex items-center justify-center w-full md:border-r md:w-96">
<a href="/git-read/tags/v0.0.1/">          git-read
</a>      </h1>

      <nav class="flex flex-grow justify-between items-center border-t p-3 fixed inset-x-0 bottom-0 bg-white z-10 md:px-4 md:py-0 md:bg-transparent md:border-0 md:relative">

<a href="/git-read/commits/11c6c630ca60e3977a022f0b1009512b7a0f8e80/">              &#8592; Previous
</a>
          <span class="flex-grow"><!-- ensure the links are pushed to the container's extremes --></span>

<a href="/git-read/commits/10a308f76c4914a39284b8b21b2a83cfcc32431a/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="flex flex-col md:flex-row">
      <details id="navigation" class="relative pb-8 md:h-screen-fit" data-turbolinks-permanent>
        <summary class="cursor-pointer inset-0 top-auto list-none outline-none md:relative">
          <span class="sr-only open:hidden">Expand History</span>
          <span class="sr-only hidden open:initial">Collapse History</span>
          <div class="md:h-screen-fit flex flex-col border-b border-t h-8 w-full justify-center md:w-8 md:border-r md:border-l md:border-t-0 open:absolute inset-x-0 bottom-0 top-auto md:top-0 md:left-auto">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="transform rotate-90 open:-rotate-90 md:rotate-0 md:open:rotate-180">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

          </div>
        </summary>

        <nav class="flex flex-col px-4 my-4 overflow-y-auto h-48 w-screen current-within:font-bold md:h-screen-fit md:w-96 md:my-auto md:p-2 md:pr-10 md:space-y-2">
<a href="/git-read/commits/2a4441cc551f2fd73f05b8d25328a6d0d0d9ed99/">              <p>Elaborate on the project&#39;s goals in the README.md</p>

</a><a href="/git-read/commits/1b46163dfde3fcdc734ef11daef07972c7fd4c99/">              <p>[GENERATED]: Scaffold the project with Middleman</p>

</a><a href="/git-read/commits/1874624426883ffed07c46686860aeb53a3d1eee/">              <p>Replace Generated Files with Static HTML and CSS</p>

</a><a href="/git-read/commits/fbe6992e7bed119e25961f6c7f0c8c051c8f1cbe/">              <p>Exercise the application through a System Test</p>

</a><a href="/git-read/commits/8cec38432ea0f127de4d3229a475f9dbb541d613/">              <p>Introduce Redcarpet Markdown Engine</p>

</a><a href="/git-read/commits/f6656aeaaee85534e9cbe29bec7b1d57fda69af8/">              <p>Generate <code>/index.html</code> dynamically</p>

</a><a href="/git-read/commits/11c6c630ca60e3977a022f0b1009512b7a0f8e80/">              <p>Extract <code>ApplicationSystemTestCase</code></p>

</a><a href="/git-read/commits/f20a636c79ff7c83028608e9df1804378feb7ea2/" aria-current="page">              <p>Render the contents of a Commit&#39;s Message</p>

</a><a href="/git-read/commits/10a308f76c4914a39284b8b21b2a83cfcc32431a/">              <p>Navigate to previous commit</p>

</a><a href="/git-read/commits/ad86bb3ef42db28e3e425e650ff5e3579d98e088/">              <p>Navigate to next commit</p>

</a><a href="/git-read/commits/a85d19480552b8ded546e4f99228ea5f95d3ddd8/">              <p>Dynamically determine project title</p>

</a><a href="/git-read/commits/15131b02c6807fc8b18a5809679443fcb4b7c37f/">              <p>Extract <code>UrlHelpers</code></p>

</a><a href="/git-read/commits/1c0dfb0535399cf1b8775a997d41c4d104db3887/">              <p>Add &quot;current&quot; styles to <code>&lt;a&gt;</code> elements</p>

</a><a href="/git-read/commits/bcbe51be2fe7c9e79df007c2de056c4caa515f65/">              <p>Syntax highlight Markdown fenced code blocks</p>

</a><a href="/git-read/commits/54dda3db29b3cea6d0534fe7d959c4b61617eb5d/">              <p>Introduce <code>bin/git-read</code> command line interface</p>

</a><a href="/git-read/commits/5811e0f19e12228cad2bba4380258622fd4fbf25/">              <p>Add <code>bin/git-read --server</code> flag</p>

</a><a href="/git-read/commits/cd81aed41b5b4d59686a14498b8eecfd37153501/">              <p>Extract <code>GitHelpers</code> from System Test Cases</p>

</a><a href="/git-read/commits/1d0ada9b715d2bf4f4a666f91f987c37415b3ee4/">              <p>Add support for re-writing a project&#39;s history</p>

</a><a href="/git-read/commits/30f633965982817836211760978097b8d0179fd3/">              <p>Extract <code>Commit</code> model</p>

</a><a href="/git-read/commits/55bae90277ece29a7bac3d79ce5fe825ab5d1ab7/">              <p>Render how a commit changes the project&#39;s files</p>

</a><a href="/git-read/commits/e40faa75c25412b851d03549131f51d3bc6720ad/">              <p>Extract SVG images</p>

</a><a href="/git-read/commits/747c19f320046bb704f26524dd67d1ee5bf9a06c/">              <p>Render history of tag, commits to home link</p>

</a><a href="/git-read/commits/d60a984134d03c8dda80bd08106aa50d756f2771/">              <p>Add webpack for building JavaScript</p>

</a><a href="/git-read/commits/dc1940b7effce4ea44c0014eff2e317865444e76/">              <p>Add <code>&lt;details&gt;</code> element polyfill</p>

</a><a href="/git-read/commits/a047c2b8512f5b1465a9ee9b8259c30f40a60bbc/">              <p>Scroll current Commit into view</p>

</a><a href="/git-read/commits/a7ac4f6979148c2cfffd3a927d76402dc9e647d2/">              <p>Navigate with Turbolinks</p>

</a><a href="/git-read/commits/9db5c96654bee1451f3c71f00019de07c243a7ab/">              <p>Integrate with GitHub Actions</p>

</a>        </nav>
      </details>

      <article class="flex-grow p-4 md:flex md:justify-center md:h-screen-fit md:p-8 md:overflow-y-auto lg:w-7/12">
        <section class="prose prose-lg md:prose-xl">
            <aside class="text-center p-5">
              <mark>
                You're viewing an out-of-date version of the project.

<a href="/">                  Read the latest version.
</a>              </mark>
            </aside>

          <h1 id="render-the-contents-of-a-commits-message">Render the contents of a Commit&rsquo;s Message</h1>

<p>A Git commit message follows a <a href="https://commit.style/">loose structure</a>:</p>

<blockquote>
<p>The first line of a commit message serves as a summary.  When
displayed on the web, it&rsquo;s often styled as a heading, and in emails,
it&rsquo;s typically used as the subject.  As such, you should capitalize
it and omit any trailing punctuation.  Aim for about 50 characters,
give or take, otherwise it may be painfully truncated in some
contexts.</p>

<p>Oftentimes a subject by itself is sufficient.  When it&rsquo;s not, add a
blank line (this is important) followed by one or more paragraphs hard
wrapped to 72 characters.</p>
</blockquote>

<p>Assuming that the commits adhere to that convention, the application
will split out the commit&rsquo;s subject line from the rest of the message,
and treat it as the resulting HTML page&rsquo;s title.</p>

<p>The call to <code>subject.strip</code> in the <code>source/commits/commit</code> template is
deliberate and important. Without it, a trailing new-line character
would separate the title from its underlining <code>===</code> syntax, which would
signal to the Markdown generator that it was to be represented as a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p"><code>&lt;p&gt;</code> element`</a> instead of an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements"><code>&lt;h1&gt;</code> element</a>.</p>

<h2 id="navigating-the-history">Navigating the history</h2>

<p>Both the <code>/index.html</code> and specific <code>/commits/$SHA/index.html</code> pages
render the project&rsquo;s history in a navigable sidebar. To power this
feature, and to ensure that the data is shared across <a href="https://middlemanapp.com/advanced/dynamic-pages#defining-proxies">Middleman&rsquo;s proxy
templates</a>, extract a <a href="#config.rb"><code>config.rb</code></a>-local variable,
which is declared and shared by <a href="https://ruby-doc.org/core-2.7.0/Hash.html#method-i-merge">merging in additional template local
variables</a> as the <a href="https://middlemanapp.com/basics/partials/"><code>local:</code> key</a>.</p>

<p>The history is meant to be read start-to-finish (as opposed to the
typical latest-to-first output that a default <a href="https://www.git-scm.com/docs/git-log"><code>git log</code></a> call
provides).</p>

<p>To achieve this order, chain a call to
<a href="https://ruby-doc.org/core-2.7.0/Enumerable.html#method-i-reverse_each"><code>Enumerable#reverse_each</code></a> onto calls to
<code>repository.log</code>. The <code>#log</code> method receives a limit on the number of
commits to provide. We want the full history, so we pass <code>nil</code>.</p>

<p>There are times when a commit&rsquo;s subject line contains Markdown that we
<em>do not</em> want to inline as raw HTML. To support this, wrap the
navigation item&rsquo;s text in calls to the new <code>#markdown</code> helper declared
within [<code>config.rb</code>][#config.rb]. This helper utilizes the underlying
<a href="https://middlemanapp.com/basics/templating-language/">Markdown engine that Middleman has registered</a> with
<a href="https://github.com/rtomayko/tilt/tree/v2.0.10#template-mappings"><code>Tilt</code></a>.</p>

        </section>
      </article>

        <aside class="md:h-screen-fit md:overflow-y-auto lg:w-5/12">
            <details id="config.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">config.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config.rb b/config.rb
index f261291..ee25085 100644
</span><span class="gd">--- a/config.rb
</span><span class="gi">+++ b/config.rb
</span><span class="p">@@ -34,20 +34,40 @@</span> repository = Git.open(
   Pathname(ENV.fetch("GIT_DIR", File.dirname(__FILE__))),
 )
 
<span class="gi">+locals = {
+  history: {
+    commits: repository.log(nil).reverse_each,
+  },
+}
+
</span> latest_readme = repository.show("HEAD:README.md")
 proxy(
   "index.html",
   "README.html",
<span class="gd">-  locals: {
</span><span class="gi">+  locals: locals.merge(
</span>     commit: repository.object("HEAD"),
     contents: latest_readme,
     page: {
       title: latest_readme.lines.first,
     },
<span class="gd">-  },
</span><span class="gi">+  ),
</span>   ignore: true,
 )
 
<span class="gi">+locals.dig(:history, :commits).each do |commit|
+  proxy(
+    "/commits/#{commit.sha}/index.html",
+    "/commits/commit.html",
+    locals: locals.merge(
+      commit: commit,
+      page: {
+        title: commit.message.lines.first,
+      }
+    ),
+    ignore: true,
+  )
+end
+
</span> # Helpers
 # Methods defined in the helpers block are available in templates
 # https://middlemanapp.com/basics/helper-methods/
<span class="p">@@ -58,6 +78,14 @@</span> proxy(
 #   end
 # end
 
<span class="gi">+helpers do
+  def markdown(content)
+    template = Tilt[:md].new { content }
+
+    template.render
+  end
+end
+
</span> # Build-specific configuration
 # https://middlemanapp.com/advanced/configuration/#environment-specific-settings
 
</code></pre></div></details>

            <details id="source/commits/commit.html.md.erb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">source/commits/commit.html.md.erb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/commits/commit.html.md.erb b/source/commits/commit.html.md.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..b05055b
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/source/commits/commit.html.md.erb
</span><span class="p">@@ -0,0 +1,6 @@</span>
<span class="gi">+&lt;% subject, *messages = commit.message.lines %&gt;
+
+&lt;%= subject.strip %&gt;
+===
+
+&lt;%= messages.join %&gt;
</span></code></pre></div></details>

            <details id="source/layouts/layout.erb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">source/layouts/layout.erb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/source/layouts/layout.erb b/source/layouts/layout.erb
index ad34538..edafa73 100644
</span><span class="gd">--- a/source/layouts/layout.erb
</span><span class="gi">+++ b/source/layouts/layout.erb
</span><span class="p">@@ -40,11 +40,14 @@</span>
               u-db-overflow-y--auto
               u-mb-overflow-x--scroll
             "&gt;
<span class="gd">-              &lt;a href="#" class="commit-node commit-node--collapsed" title="[GENERATED]: Scaffold the project with Middleman"&gt;
-              &lt;/a&gt;
-
-              &lt;a href="#" class="commit-node commit-node--collapsed" title="Elaborate on the project's goals in the README.md"&gt;
-              &lt;/a&gt;
</span><span class="gi">+              &lt;% history[:commits].each do |commit| %&gt;
+                &lt;%= link_to(
+                  "",
+                  "/commits/#{commit.sha}/index.html",
+                  class: "commit-node commit-node--collapsed",
+                  title: commit.message.lines.first
+                ) %&gt;
+              &lt;% end %&gt;
</span>             &lt;/nav&gt;
 
             &lt;div class="accordion__toggle"&gt;
<span class="p">@@ -89,13 +92,14 @@</span>
           u-db-overflow-y--auto
           u-mb-overflow-x--scroll
         "&gt;
<span class="gd">-          &lt;a href="#" class="commit-node commit-node--full"&gt;
-            [GENERATED]: Scaffold the project with Middleman
-          &lt;/a&gt;
-
-          &lt;a href="#" class="commit-node commit-node--full"&gt;
-            Elaborate on the project's goals in the README.md
-          &lt;/a&gt;
</span><span class="gi">+          &lt;% history[:commits].each do |commit| %&gt;
+            &lt;% link_to(
+              "/commits/#{commit.sha}/index.html",
+              class: "commit-node commit-node--full",
+            ) do %&gt;
+              &lt;%= markdown(commit.message.lines.first) %&gt;
+            &lt;% end %&gt;
+          &lt;% end %&gt;
</span>         &lt;/nav&gt;
       &lt;/details&gt;
 
</code></pre></div></details>

            <details id="test/system/visitor_views_commits_test.rb" open class="border-l border-r">
  <summary class="border-b cursor-pointer list-style-none p-4 outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" role="img" class="h-8 mr-4 inline transform rotate-90 open:-rotate-90">
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code class="break-all">test/system/visitor_views_commits_test.rb</code>
  </summary>
<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/visitor_views_commits_test.rb b/test/system/visitor_views_commits_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..942b0c2
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/system/visitor_views_commits_test.rb
</span><span class="p">@@ -0,0 +1,33 @@</span>
<span class="gi">+require "application_system_test_case"
+
+class VisitorViewsCommitsTest &lt; ApplicationSystemTestCase
+  test "visitor views commits" do
+    stage_file("README.md", "Ignore me")
+    commit("Ignore me")
+    stage_file("file.txt", "Ignore me")
+    commit(&lt;&lt;~MARKDOWN)
+    The commit subject
+
+    The commit body
+    MARKDOWN
+
+    with_git_repository do
+      visit "/index.html"
+      click_on "The commit subject"
+
+      assert_selector "h1", text: "The commit subject"
+      assert_selector "p", text: "The commit body"
+    end
+  end
+
+  test "visitor views commit with HTML in the subject line" do
+    stage_file("README.md", "Ignore me")
+    commit("This subject has a `&lt;h1&gt;` in it")
+
+    with_git_repository do
+      visit "/index.html"
+
+      assert_text "This subject has a &lt;h1&gt; in it"
+    end
+  end
+end
</span></code></pre></div></details>

        </aside>
    </main>
  </body>
</html>
